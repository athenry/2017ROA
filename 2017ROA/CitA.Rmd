---
title: "University of Alberta Faculty of Engineering Research Output"
author: "Alison Henry"
date: "September 29, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```
## This code expects downloaded BibTex files to to be in a subdirectory of your working directory called WoSdata. Update line 22 as needed. Edit deptUrl to reflect your source of departmental abbreviations and full names. Users from other institutions will want to modify the "Remove non-UofA addresses" section to reflect their institutional affiliation.  

## Install and load needed packages: bibliometrix, splitstackshape

```{r}
install.packages("bibliometrix", dependencies = TRUE)
install.packages("splitstackshape")
install.packages("ggplot2")
install.packages("stringr")
install.packages("plyr")

library(bibliometrix)
library(splitstackshape)
library(ggplot2)
library(stringr)
library(plyr)
```


## Read in downloaded files and convert to dataframe

```{r}
filePaths = dir("./WoSdata", pattern = "*.bib", recursive = TRUE, full.names = TRUE) 
D <- do.call("readFiles", as.list(filePaths)) 
M <- convert2df(D, dbsource = "isi", format = "bibtex")
```
## Keep only selected columns: UT, AU, DT, C1, TC, PY
```{r}
mydata <- subset(M, select = c(UT, C1, DT, TC, PY))
```
## Separate authors into single observations
```{r}
tidy_data <- cSplit(mydata, "C1", sep = ";", direction = "long")
```
## Test that there were no unintended drops
```{r}
count <- sum(str_count(mydata$C1, ";"))
ifelse(count + nrow(mydata) == nrow(tidy_data), "No drops", "Warning") 
```
## Remove non-UofA addresses
```{r}
AlbertaData <- tidy_data[grep("UNIV ALBERTA", tidy_data$C1), ]
```
## Identify departmental affiliations: need to automate this
## deptUrl <- ("https://docs.google.com/spreadsheets/d/e/2PACX-1vTMpIJn2N9pV13zRhYKRdOOAUfvHhKF6dqUzMWhnk3_eaBgPD8XT6UJBuAXfyoWfA0qfvaO4LyQpfJA/pub?output=csv")
## depts <- read.csv(deptUrl)
```{r}
AlbertaData$Dept <- ifelse(grepl(" CHEM ", AlbertaData$C1), "Department of Chemical and Materials Engineering",
                    ifelse(grepl(" MAT ", AlbertaData$C1), "Department of Chemical and Materials Engineering",
                    ifelse(grepl(" CIVIL ", AlbertaData$C1), "Department of Civil and Environmental Engineering",
                    ifelse(grepl(" SCH MIN ", AlbertaData$C1), "Department of Civil and Environmental Engineering",
                    ifelse(grepl(" PETR ", AlbertaData$C1), "Department of Civil and Environmental Engineering",
                    ifelse(grepl(" ELECT ", AlbertaData$C1), "Department of Electrical and Computer Engineering",
                    ifelse(grepl(" MECH ", AlbertaData$C1), "Department of Mechanical Engineering",
                    ifelse(grepl(" BIOMED ", AlbertaData$C1), "Department of Biomedical Engineering",
                           "Other"))))))))
```
## check "other"s


## Report number of articles per year per department 
## Report nu,ber of citations per department per year