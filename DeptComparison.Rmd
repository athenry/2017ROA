---
title: "Faculty of Engineering Research Output"
subtitle: "University of Alberta"
author: "Alison Henry"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
 word_document:
                df_print: kable
bibliography: ROA2017.bib
csl: chemical-engineering-journal.csl
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE, message = FALSE, warning  = FALSE)
```
A report to examine the publication output of the Univeristy of Alberta Faculty of Engineering. Searches were conducted using Web of Science, and limited to the five publication years from 2012-2016. 

```{r package installation}
##Install and load needed packages

##install.packages("splitstackshape")
##install.packages("tidyverse")
##install.packages("viridis")
##install.packages("knitr")

library(splitstackshape)
library(tidyverse)
library(stringr)
library(viridis)
library(knitr)
```
Initial processing of the data was accomplished with the Bibliometrix package written by Massimo Aria and Corrado Cuccurullo[@RefWorks:doc:59d24e48e4b0b590b97a2290]. This allowed easy conversion of records into a data frame to facilitate further processing.

```{r data import}
## read in U15 publication data from previous process, add school name column to each
Alberta <- read.csv("Alberta.csv", sep = ",")
Alberta$PY <- as.factor(Alberta$PY)
Alberta$School <- "Alberta"
Alberta$School <- as.factor(Alberta$School)

Calgary <- read.csv("Calgary.csv", sep = ",")
Calgary$PY <- as.factor(Calgary$PY)
Calgary$School <- "Calgary"
Calgary$School <- as.factor(Calgary$School)

Dalhousie <- read.csv("Dalhousie.csv", sep = ",")
Dalhousie$PY <- as.factor(Dalhousie$PY)
Dalhousie$School <- "Dalhousie"
Dalhousie$School <- as.factor(Dalhousie$School)

Laval <- read.csv("Laval.csv", sep = ",")
Laval$PY <- as.factor(Laval$PY)
Laval$School <- "Laval"
Laval$School <- as.factor(Laval$School)

Manitoba <- read.csv("Manitoba.csv", sep = ",")
Manitoba$PY <- as.factor(Manitoba$PY)
Manitoba$School <- "Manitoba"
Manitoba$School <- as.factor(Manitoba$School)

McGill <- read.csv("McGill.csv", sep = ",")
McGill$PY <- as.factor(McGill$PY)
McGill$School <- "McGill"
McGill$School <- as.factor(McGill$School)

McMaster <- read.csv("McMaster.csv", sep = ",")
McMaster$PY <- as.factor(McMaster$PY)
McMaster$School <- "McMaster"
McMaster$School <- as.factor(McMaster$School)

Ottawa <- read.csv("Ottawa.csv", sep = ",")
Ottawa$PY <- as.factor(Ottawa$PY)
Ottawa$School <- "Ottawa"
Ottawa$School <- as.factor(Ottawa$School)

Montreal <- read.csv("Montreal.csv", sep = ",")
Montreal$PY <- as.factor(Montreal$PY)
Montreal$School <- "Montreal"
Montreal$School <- as.factor(Montreal$School)

Queens <- read.csv("Queens.csv", sep = ",")
Queens$PY <- as.factor(Queens$PY)
Queens$School <- "Queens"
Queens$School <- as.factor(Queens$School)

Saskatchewan <- read.csv("Saskatchewan.csv", sep = ",")
Saskatchewan$PY <- as.factor(Saskatchewan$PY)
Saskatchewan$School <- "Saskatchewan"
Saskatchewan$School <- as.factor(Saskatchewan$School)

Toronto <- read.csv("Toronto.csv", sep = ",")
Toronto$PY <- as.factor(Toronto$PY)
Toronto$School <- "Toronto"
Toronto$School <- as.factor(Toronto$School)

UBC <- read.csv("UBC.csv", sep = ",")
UBC$PY <- as.factor(UBC$PY)
UBC$School <- "UBC"
UBC$School <- as.factor(UBC$School)

Waterloo <- read.csv("Waterloo.csv", sep = ",")
Waterloo$PY <- as.factor(Waterloo$PY)
Waterloo$School <- "Waterloo"
Waterloo$School <- as.factor(Waterloo$School)

Western <- read.csv("Western.csv", sep = ",")
Western$PY <- as.factor(Western$PY)
Western$School <- "Western"
Western$School <- as.factor(Western$School)

```
Publication data was grouped by department to facilitate disciplinary comparison. Note that the disciplines are grouped differently at different schools, and not all schools have Alberta-equivalent departments. 

```{r departmental sorting}
civil <- rbind(filter(Alberta, Department == "Civil and Environmental Engineering"), filter(Calgary, Department == "Civil Engineering"| Department == "Geomatics Engineering"), filter(Dalhousie, Department == "Civil and Resource Engineering"), filter(Laval, Department == "Civil Engineering and Water Engineering" | Department == "Geology and Geological Engineering"), filter(Manitoba, Department == "Civil Engineering"), filter (McGill, Department == "Civil Engineering and Applied Mechanics" | Department == "Mining and Materials Engineering"), filter(McMaster, Department == "Civil Engineering"), filter(Montreal, Department == "Civil Geological and Mining Engineering"), filter(Ottawa, Department == "Civil Engineering"), filter(Queens, Department =="Civil Engineering" | Department == "Robert M. Buchan Department of Mining" | Department == "Geological Engineering"), filter(Saskatchewan, Department == "Civil, Geological and Environmental Engineering"), filter(Toronto, Department == "Civil and Mineral Engineering"), filter(UBC, Department == "Civil Engineering" | Department == "Keevil Institute of Mining Engineering"), filter(Waterloo, Department == " Civil & Environmental Engineering"), filter(Western, Department =="Civil and Environmental Engineering"))

chemmat <- rbind(filter(Alberta, Department == "Chemical and Materials Engineering"), filter(Calgary, Department == "Chemical and Petroleum Engineering"), filter(Dalhousie, Department == "Process Engineering & Applied Science"), filter(Laval, Department =="Chemical Engineering" | Department == "Mineral, Metallurgical, and Materials Engineering"), filter(McGill, Department == "Chemical Engineering" | Department == "Mining and Materials Engineering"), filter(McMaster, Department == "Chemical Engineering" | Department == "Materials Science and Engineering"), filter(Montreal, Department == "Chemical Engineering"), filter(Ottawa, Department =="Chemical and Biological Engineering"), filter(Queens, Department == "Chemical Engineering" | Department == "Mechanical and Materials Engineering"), filter(Saskatchewan, Department == "Chemical and Biological Engineering"), filter(Toronto, Department == "Chemical Engineering & Applied Chemistry" | Department == "Materials Science & Engineering"), filter(UBC, Department == "Chemical and Biological Engineering" | Department == "Materials Engineering"), filter(Waterloo, Department == "Chemical Engineering"), filter(Western, Department == "Chemical and Biomedical Engineering" | Department == "Mechanical and Materials Engineering"))

mechanical <- rbind(filter(Alberta, Department == "Mechanical Engineering"), filter(Calgary, Department == "Mechanical and Manufacturing Engineering"), filter(Dalhousie, Department == "Mechanical Engineering"), filter(Laval, Department =="Mechanical Engineering"), filter(Manitoba, Department == "Mechanical Engineering"), filter(McGill, Department == "Mechanical Engineering"), filter(McMaster, Department == "Mechanical Engineering"), filter(Montreal, Department == "Mechanical Engineering"), filter(Ottawa, Department =="Mechanical Engineering"), filter(Queens, Department == "Mechanical and Materials Engineering"), filter(Saskatchewan, Department == "Mechanical Engineering"), filter(Toronto, Department == "Mechanical & Industrial Engineering"), filter(UBC, Department == "Mechanical Engineering"), filter(Waterloo, Department == "Mechanical & Mechatronics Engineering"), filter(Western, Department == "Mechanical and Materials Engineering"))

electrical <- rbind(filter(Alberta, Department == "Electrical and Computer Engineering"), filter(Calgary, Department == "Electrical and Computer Engineering"), filter(Dalhousie, Department == "Electrical and Computer Engineering"), filter(Laval, Department =="Electrical and Computer Engineering" | Department == "Computer Science and Software Engineering"), filter(Manitoba, Department == "Computer & Electrical Engineering"), filter(McGill, Department == "Electrical and Computer Engineering"), filter(McMaster, Department == "Computing and Software" | Department == "Electrical and Computer Engineering"), filter(Montreal, Department == "Electrical Engineering" | Department == "Computer Engineering"), filter(Ottawa, Department =="Electrical Engineering and Computer Science"), filter(Queens, Department == "Electrical and Computer Engineering"), filter(Saskatchewan, Department == "Electrical and Computer Engineering"), filter(Toronto, Department == "Electrical & Computer Engineering"), filter(UBC, Department == "Electrical and Computer Engineering"), filter(Waterloo, Department == "Electrical & Computer Engineering"), filter(Western, Department == "Electrical and Computer Engineering"))

biomed <- rbind(filter(Alberta, Department == "Biomedical Engineering"), filter(Calgary, Department == "Biomedical Engineering Grad Program"), filter(Dalhousie, Department == "Biomedical Engineering"), filter(Manitoba, Department == "Biosystems Engineering"), filter(McGill, Department == "Bioengineering"), filter(McMaster, Department == "School of Biomedical Engineering"), filter(Montreal, Department == "Institute of Biomedical Engineering"), filter(Ottawa, Department =="Chemical and Biological Engineering"), filter(Saskatchewan, Department == "Biomedical Engineering"), filter(Toronto, Department == "Biomaterials & Biomechanical Engineering"), filter(UBC, Department == "Biomedical Engineering"), filter(Waterloo, Department == "Centre for Bioengineering and Biotechnology"), filter(Western, Department == "Chemical and Biomedical Engineering"))
```

###Publication record

```{r include = TRUE, echo = FALSE, results='asis'}
biomedCt <- count(biomed, PY, School)
biomedAY <- spread(biomedCt, PY, n)

chemmatCt <- count(chemmat, PY, School)
chemmatAY <- spread(chemmatCt, PY, n)

civilCt <- count(civil, PY, School)
civilAY <- spread(civilCt, PY, n)

elecCt <- count(electrical, PY, School)
elecAY <- spread(elecCt, PY, n)

mechCt <- count(mechanical, PY, School)
mechAY <- spread(mechCt, PY, n)

kable(arrange(biomedAY, desc(biomedAY$`2016`)), caption = "Articles per year - Biomedical Engineering")

kable(arrange(chemmatAY, desc(chemmatAY$`2016`)), caption = "Articles per year - Chemical and Materials Engineering")

kable(arrange(civilAY, desc(civilAY$`2016`)), caption = "Articles per year - Civil Engineering")

kable(arrange(elecAY, desc(elecAY$`2016`)), caption = "Articles per year - Electrical and Computer Engineering")

kable(arrange(mechAY, desc(mechAY$`2016`)), caption = "Articles per year - Mechanical Engineering")

```

###Research output per faculty 

Annual faculty numbers were not available for all Alberta departments, nor for all institutions. Departmental-level Articles/year/faculty was calculated for 8 of the 15 Canadian schools. This calculation was also done at the overall institution level for the other 7 schools.

```{r output-per-faculty, include = TRUE, echo = FALSE, results='asis'}

## Articles per year per faculty
AlbertaFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=1250905174&single=true&output=csv")
names(AlbertaFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
AlbertaFac$School <- "Alberta"

CalgaryFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=1767152235&single=true&output=csv")
names(CalgaryFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
CalgaryFac$School <- "Calgary"

McMasterFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=377980857&single=true&output=csv")
names(McMasterFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
McMasterFac$School <- "McMaster"

MontrealFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=1362062123&single=true&output=csv")
names(MontrealFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
MontrealFac$School <- "Montreal"

OttawaFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=391352894&single=true&output=csv")
names(OttawaFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
OttawaFac$School <- "Ottawa"

TorontoFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=636662368&single=true&output=csv")
names(TorontoFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
TorontoFac$School <- "Toronto"

WaterlooFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=1597376299&single=true&output=csv")
names(WaterlooFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
WaterlooFac$School <- "Waterloo"

WesternFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=757635134&single=true&output=csv")
names(WesternFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
WesternFac$School <- "Western" 

chemmatFac <- rbind(filter(AlbertaFac, Department == "Chemical and Materials Engineering"), filter(CalgaryFac, Department == "Chemical and Materials Engineering"), filter(McMasterFac, Department == "Chemical Engineering" | Department == "Materials Science and Engineering"), filter(MontrealFac, Department == "Chemical engineering"), filter(OttawaFac, Department == "Chemical & Biological"), filter(TorontoFac, Department == "Department of Chemical Engineering and Applied Chemistry" | Department == "Department of Materials Science and Engineering"), filter(WaterlooFac, Department == "Chemical Engineering"), filter(WesternFac, Department == "Chemical and Biochemical Engineering"))

civilFac <- rbind(filter(AlbertaFac, Department == "Civil Engineering"), filter(CalgaryFac, Department == "Civil Engineering" | Department == "Geomatics Engineering"), filter(McMasterFac, Department == "Civil Engineering"), filter(MontrealFac, Department == "Civil, geological and mining engineering"), filter(OttawaFac, Department == "Civil" | Department == "Environmental Engineering"), filter(TorontoFac, Department == "Department of Civil Engineering" | Department == "Lassonde Institute of Mining"), filter(Waterloo, Department == "Civil and Environmental Engineering"), filter(WesternFac, Department == "Civil & Environmental Engineering"))

elecFac <- rbind(filter(AlbertaFac, Department == "Electrical and Computer Engineering"), filter(CalgaryFac, Department == "Electrical & Computer Engineering"), filter(McMasterFac, Department == "Electrical and Computer Engineering" | Department == "Computing and Software"), filter(MontrealFac, Department == "Electrical engineering" | Department == "Computer and Software Engineering"), filter(OttawaFac, Department == "Electrical Engineering and Computer Science"), filter(TorontoFac, Department == "Edward S. Rogers Sr. Department of Electrical and Computer Engineering"), filter(WaterlooFac, Department == "Electrical and Computer Engineering"), filter(WesternFac, Department == "Electrical and Computer Engineering"))

mechFac <- rbind(filter(AlbertaFac, Department == "Mechanical Engineering"), filter(CalgaryFac, Department == "Mechanical & Manufacturing Engineering"), filter(McMasterFac, Department == "Mechanical Engineering"), filter(MontrealFac, Department == "Mechanical engineering"), filter(OttawaFac, Department == "Mechanical"), filter(TorontoFac, Department == "Department of Mechanical and Industrial Engineering"), filter(Waterloo, Department == "Mechanical and Mechatronics Engineering"), filter(WesternFac, Department == "Mechanical and Materials Engineering"))

chemmatFacCt <- gather(chemmatFac, key = PY, value = Fac, -Department, -School) %>%
        group_by(School, PY) %>%
        summarise(Fac = sum(Fac))

CivilFacCt <- gather(civilFac, key = PY, value = Fac, -Department, -School) %>%
        group_by(School, PY) %>%
        summarise(Fac = sum(Fac))

elecFacCt <- gather(elecFac, key = PY, value = Fac, -Department, -School) %>%
        group_by(School, PY) %>%
        summarise(Fac = sum(Fac))

mechFacCt <- gather(mechFac, key = PY, value = Fac, -Department, -School) %>%
        group_by(School, PY) %>%
        summarise(Fac = sum(Fac))

chemmatFac <- spread(chemmatFacCt, PY, Fac)
civilFac <- spread(chemmatFacCt, PY, Fac)
elecFac <- spread(elecFacCt, PY, Fac)
mechFac <- spread(mechFacCt, PY, Fac)

## Keep the rows for which we have corresponding faculty data
chemmatAPY <-filter(chemmatAY, School %in% chemmatFac$School)
civilAPY <- filter(civilAY, School %in% civilFac$School)
elecAPY <- filter(elecAY, School %in% elecFac$School)
mechAPY <- filter(mechAY, School %in% mechFac$School)

## Divide number of articles by number of faculty
chemmatAF <- cbind(chemmatAPY[1], round(chemmatAPY[-1]/chemmatFac[-1],1))
civilAF <- cbind(civilAPY[1], round(civilAPY[-1]/civilFac[-1], 1))
elecAF <- cbind(elecAPY[1], round(elecAPY[-1]/elecFac[-1], 1))
mechAF <- cbind(mechAPY[1], round(mechAPY[-1]/mechFac[-1], 1))

kable(arrange(chemmatAF, desc(chemmatAF$`2016`)), digits = 2, caption = "Articles per faculty member per year - Chemical Engineering")

kable(arrange(civilAF, desc(civilAF$`2016`)), digits = 2, caption = "Articles per faculty member per year - Civil Engineering")

kable(arrange(elecAF, desc(elecAF$`2016`)), digits = 2, caption = "Articles per faculty member per year - Electrical Engineering")

kable(arrange(mechAF, desc(mechAF$`2016`)), digits = 2, caption = "Articles per faculty member per year - Mechanical Engineering")

## Calculate at institutional level for other U15 schools
rest <- rbind(Alberta, Dalhousie, Laval, Manitoba, McGill, Queens, Saskatchewan, UBC)
restCt <- count(rest, School)

restFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vRrKjvLcFtlRq5_iTQDl30fFM2p9DAlDMs2dbD_7UMIj42VW6CCKqxkteASf-znTvFAJjNfCPR7og4d/pub?gid=130161287&single=true&output=csv")

restAF5 <- cbind(restCt[1], round(restCt[-1]/restFac[-1], 1))
restAF <- transform(restAF5, n=n/5)

kable(arrange(restAF, desc(n)), digits = 2, caption = "Average number of articles per faculty member per year, by institution")

CanFac <- rbind(chemmatFac, civilFac, elecFac, mechFac) %>%
        gather(key = PY, value = Fac, -School, na.rm = TRUE) %>%
        group_by(School, PY) %>%
        summarise(Fac = sum(Fac)) %>%
        spread(PY, Fac)

CanComp <- rbind(biomed, chemmat, civil, electrical, mechanical) %>%
        count(PY, School) %>%
        spread(PY, n) %>%
        filter(School %in% CanFac$School)

CanAPF <- cbind(CanComp[1], round(CanComp[-1]/CanFac[-1],1)) 



kable(arrange(CanAPF, desc(CanAPF$'2016')), digits = 2, caption = "Articles per faculty member per year, Faculty-Level")
```

###Average article impact

```{r Mean citations, include = TRUE, echo = FALSE, results='asis'}
biomedTC <- biomed %>%
        group_by(School) %>% 
        summarise('Times Cited' = mean(TC))

chemmatTC <- chemmat %>%
        group_by(School) %>% 
        summarise('Times Cited' = mean(TC))
        
civTC <- civil %>%
        group_by(School) %>% 
        summarise('Times Cited' = mean(TC))

elecTC <- electrical %>%
        group_by(School) %>% 
        summarise('Times Cited' = mean(TC))

mechTC <- mechanical %>%
        group_by(School) %>% 
        summarise('Times Cited' = mean(TC))

CanTC <- rbind(biomed, chemmat, civil, electrical, mechanical) %>%
        distinct(UT, School, .keep_all = TRUE) %>%
        group_by(School) %>%
        summarise('Times Cited' = mean(TC))


kable(arrange(biomedTC, desc(biomedTC$'Times Cited')), digits = 2, caption = "Mean citations per article - Biomedical Engineering")

kable(arrange(chemmatTC, desc(chemmatTC$'Times Cited')), digits = 2, caption = "Mean citations per article - Chemical and Materials Engineering")

kable(arrange(civTC, desc(civTC$'Times Cited')), digits = 2, caption = "Mean citations per article - Civil Engineering")

kable(arrange(elecTC, desc(elecTC$'Times Cited')), digits = 2, caption = "Mean citations per article - Electrical and Computer  Engineering")

kable(arrange(mechTC, desc(mechTC$'Times Cited')), digits = 2, caption = "Mean citations per article - Mechanical Engineering")

kable(arrange(CanTC, desc(CanTC$`Times Cited`)), digits = 2, caption  = "Mean citations per article per school (matching depts only)")
```

##US comparator results

Comparisons were made with select US schools in the same manner.

```{r read-in US data}
## read in publication data from previous process, add school name column to each
Alberta <- read.csv("Alberta.csv", sep = ",")
Alberta$PY <- as.factor(Alberta$PY)
Alberta$School <- "Alberta"
Alberta$School <- as.factor(Alberta$School)

CarnegieMellon <- read.csv("CarnegieMellon.csv", sep = ",")
CarnegieMellon$PY <- as.factor(CarnegieMellon$PY)
CarnegieMellon$School <- "CarnegieMellon"
CarnegieMellon$School <- as.factor(CarnegieMellon$School)

ColoradoBoulder <- read.csv("ColoradoBoulder.csv", sep = ",")
ColoradoBoulder$PY <- as.factor(ColoradoBoulder$PY)
ColoradoBoulder$School <- "ColoradoBoulder"
ColoradoBoulder$School <- as.factor(ColoradoBoulder$School)

Duke <- read.csv("Duke.csv", sep = ",")
Duke$PY <- as.factor(Duke$PY)
Duke$School <- "Duke"
Duke$School <- as.factor(Duke$School)

Florida <- read.csv("Florida.csv", sep = ",")
Florida$PY <- as.factor(Florida$PY)
Florida$School <- "Florida"
Florida$School <- as.factor(Florida$School)

GeorgiaTech <- read.csv("GeorgiaTech.csv", sep = ",")
GeorgiaTech$PY <- as.factor(GeorgiaTech$PY)
GeorgiaTech$School <- "GeorgiaTech"
GeorgiaTech$School <- as.factor(GeorgiaTech$School)

IllinoisUC <- read.csv("IllinoisUC.csv", sep = ",")
IllinoisUC$PY <- as.factor(IllinoisUC$PY)
IllinoisUC$School <- "IllinoisUC"
IllinoisUC$School <- as.factor(IllinoisUC$School)

Michigan <- read.csv("Michigan.csv", sep = ",")
Michigan$PY <- as.factor(Michigan$PY)
Michigan$School <- "Michigan"
Michigan$School <- as.factor(Michigan$School)

Minnesota <- read.csv("Minnesota.csv", sep = ",")
Minnesota$PY <- as.factor(Minnesota$PY)
Minnesota$School <- "Minnesota"
Minnesota$School <- as.factor(Minnesota$School)

UTAustin <- read.csv("UTAustin.csv", sep = ",")
UTAustin$PY <- as.factor(UTAustin$PY)
UTAustin$School <- "UTAustin"
UTAustin$School <- as.factor(UTAustin$School)

Wisconsin <- read.csv("Wisconsin.csv", sep = ",")
Wisconsin$PY <- as.factor(Wisconsin$PY)
Wisconsin$School <- "Wisconsin"
Wisconsin$School <- as.factor(Wisconsin$School)
```
```{r departmental grouping}
## Group publication data by department 
biomedUS <- rbind(filter(Alberta, Department == "Biomedical Engineering"), filter(CarnegieMellon, Department == "Biomedical Engineering"), filter(ColoradoBoulder, Department == "Chemical & Biomedical Engineering"), filter(Duke, Department == "Biomedical Engineering"), filter(Florida, Department == "Biomedical Engineering"), filter (GeorgiaTech, Department == "Biomedical Engineering"), filter(IllinoisUC, Department == "Bioengineering"), filter(Michigan, Department == "Biomedical Engineering"), filter(Minnesota, Department == "Biomedical Engineering"), filter(UTAustin, Department =="Biomedical Engineering"), filter(Wisconsin, Department == "Biomedical Engineering"))

chemmatUS <- rbind(filter(Alberta, Department == "Chemical and Materials Engineering"), filter(CarnegieMellon, Department == "Chemical Engineering" | Department == "Materials Science and Engineering"), filter(ColoradoBoulder, Department == "Chemical & Biomedical Engineering"), filter(Duke, Department == "Mechanical Engineering & Materials Science"), filter(Florida, Department == "Chemical Engineering" | Department == "Materials Science & Engineering"), filter (GeorgiaTech, Department == "Chemical and Biomolecular Engineering" | Department == "Materials Science and Engineering"), filter(IllinoisUC, Department == "Chemical & Biomolecular Engineering" | Department == "Materials Science & Engineering"), filter(Michigan, Department == "Chemical Engineering" | Department == "Materials Science and Engineering"), filter(Minnesota, Department == "Chemcial Engineering and Materials Science"), filter(UTAustin, Department =="Chemical Engineering" | Department == "Materials Science and Engineering"), filter(Wisconsin, Department == "Chemical & Biological Engineering" | Department == "Materials Science & Engineering"))

civilUS <- rbind(filter(Alberta, Department == "Civil and Environmental Engineering"), filter(CarnegieMellon, Department == "Civil & Environmental Engineering"), filter(ColoradoBoulder, Department == "Civil, Envionmental & Architectural Engineering"), filter(Duke, Department == "Civil & Environmental Engineering"), filter(Florida, Department == "Engineering School of Sustainable Infrastucuture & Environment"), filter (GeorgiaTech, Department == "Civil and Environmental Engineering"), filter(IllinoisUC, Department == "Civil & Environmental Engineering"), filter(Michigan, Department == "Civil and Environmental Engineering"), filter(Minnesota, Department == "Civil, Environmental, and Geo-Engineering"), filter(UTAustin, Department =="Civil, Architectural and Environmental Engineering" | Department == "Petroleum and Geosystems Engineering"), filter(Wisconsin, Department == "Civil & Environmental Engineering"))

elecUS <- rbind(filter(Alberta, Department == "Electrical and Computer Engineering"), filter(CarnegieMellon, Department == "Electrical & Computer Engineering"), filter(ColoradoBoulder, Department == "Electrical, Computer & Engergy Engineering" | Department == "Computer Science"), filter(Duke, Department == "Electrical & Computer Engineering"), filter(Florida, Department == "Electrical & Computer Engineering"), filter (GeorgiaTech, Department == "Electrical and Computer Engineering"), filter(IllinoisUC, Department == "Electrical & Computer Engineering"), filter(Michigan, Department == "Electrical Engineering and Computer Science"), filter(Minnesota, Department == "Electrical and Computer Engineering"), filter(UTAustin, Department =="Electrical and Computer Engineering"), filter(Wisconsin, Department == "Electrical & Computer Engineering"))

mechUS <- rbind(filter(Alberta, Department == "Mechanical Engineering"), filter(CarnegieMellon, Department == "Mechanical Engineering"), filter(ColoradoBoulder, Department == "Mechanical Engineering"), filter(Duke, Department == "Mechanical Engineering & Materials Science"), filter(Florida, Department == "Mechanical & Aerospace Engineering"), filter (GeorgiaTech, Department == "Mechanical Engineering"), filter(IllinoisUC, Department == "Mechanical Science and Engineering "), filter(Michigan, Department == "Mechanical Engineering"), filter(Minnesota, Department == "Mechanical Engineering"), filter(UTAustin, Department =="Mechanical Engineering"), filter(Wisconsin, Department == "Mechanical Engineering"))
```

###Publication Record

```{r articles, include=TRUE, echo=FALSE}
## Article counts
USbiomedCt <- count(biomedUS, PY, School)
USbiomedAY <- spread(USbiomedCt, PY, n)

USchemmatCt <- count(chemmatUS, PY, School)
USchemmatAY <- spread(USchemmatCt, PY, n)

UScivilCt <- count(civilUS, PY, School)
UScivilAY <- spread(UScivilCt, PY, n)

USelecCt <- count(elecUS, PY, School)
USelecAY <- spread(USelecCt, PY, n)

USmechCt <- count(mechUS, PY, School)
USmechAY <- spread(USmechCt, PY, n)

kable(arrange(USbiomedAY, desc(USbiomedAY$`2016`)), caption = "Articles per year - Biomedical Engineering")

kable(arrange(USchemmatAY, desc(USchemmatAY$`2016`)), caption = "Articles per year - Chemical and Materials Engineering")

kable(arrange(UScivilAY, desc(UScivilAY$`2016`)), caption = "Articles per year - Civil Engineering")

kable(arrange(USelecAY, desc(USelecAY$`2016`)), caption = "Articles per year - Electrical and Computer Engineering")

kable(arrange(USmechAY, desc(USmechAY$`2016`)), caption = "Articles per year - Mechanical Engineering")
```

###Research output per faculty

```{r artciles per faculty, include=TRUE, echo=FALSE}
AlbertaFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=1250905174&single=true&output=csv")
names(AlbertaFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
AlbertaFac$School <- "Alberta"

CarnegieMellonFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=1316833998&single=true&output=csv")
names(CarnegieMellonFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
CarnegieMellonFac$School <- "CarnegieMellon"

ColoradoBoulderFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=1698168139&single=true&output=csv")
names(ColoradoBoulderFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
ColoradoBoulderFac$School <- "ColoradoBoulder"

DukeFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=31425859&single=true&output=csv")
names(DukeFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
DukeFac$School <- "Duke"

FloridaFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=924312962&single=true&output=csv")
names(FloridaFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
FloridaFac$School <- "Florida"

GeorgiaTechFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=637797385&single=true&output=csv")
names(GeorgiaTechFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
GeorgiaTechFac$School <- "GeorgiaTech"

IllinoisUCFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=1942492814&single=true&output=csv")
names(IllinoisUCFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
IllinoisUCFac$School <- "IllinoisUC"

MichiganFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=1225116447&single=true&output=csv")
names(MichiganFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
MichiganFac$School <- "Michigan"

MinnesotaFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=55246258&single=true&output=csv")
names(MinnesotaFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
MinnesotaFac$School <- "Minnesota"

UTAustinFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=575756157&single=true&output=csv")
names(UTAustinFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
UTAustinFac$School <- "UTAustin"

WisconsinFac <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT04KVZbmDhkrE43WSPjYgx2kKEgUdApH_z4UawFtmDKhu4sYhOaiMdZH0fdo3zo6rSSimAg7HXa7xc/pub?gid=1122732635&single=true&output=csv")
names(WisconsinFac) <- c("Department", "2012", "2013", "2014", "2015", "2016")
WisconsinFac$School <- "Wisconsin"

##Create departmental groupings
biomedFacUS <- rbind(filter(AlbertaFac, Department == "Biomedical Engineering"), filter(CarnegieMellonFac, Department == "Biomedical Engineering"), filter(ColoradoBoulderFac, Department == "Chemical and Biological Engineering"), filter(DukeFac, Department == "Biomedical Engineering"), filter(FloridaFac, Department == "J. Crayton Pruitt Family Department of Biomedical Engineering"), filter (GeorgiaTechFac, Department == "Biomedical Engineering"), filter(IllinoisUCFac, Department == "Bioengineering"), filter(MichiganFac, Department == "Biomedical Engineering"), filter(MinnesotaFac, Department == "Biomedical Engineering"), filter(UTAustinFac, Department =="Biomedical Engineering"), filter(WisconsinFac, Department == "Biomedical Engineering"))

chemmatFacUS <- rbind(filter(AlbertaFac, Department == "Chemical and Materials Engineering"), filter(CarnegieMellonFac, Department == "Chemical Engineering" | Department == "Materials Science and Engineering"), filter(ColoradoBoulderFac, Department == "Chemical and Biological Engineering" | Department == "Materials Science and Engineering"), filter(DukeFac, Department == "Mechanical Engineering and Materials Science"), filter(FloridaFac, Department == "Chemical Engineering" | Department == "Materials Science & Engineering"), filter (GeorgiaTechFac, Department == "Chemical & Biomolecular Engineering" | Department == "Materials Science & Engineering"), filter(IllinoisUCFac, Department == "Chemical and Biomolecular Engineering" | Department == "Materials Science and Engineering"), filter(MichiganFac, Department == "Chemical Engineering" | Department == "Materials Science and Engineering"), filter(MinnesotaFac, Department == "Chemical Engineering & Materials Science"), filter(UTAustinFac, Department =="Chemical Engineering"), filter(WisconsinFac, Department == "Chemical & Biological Engineering" | Department == "Materials Science & Engineering"))

civilFacUS <- rbind(filter(AlbertaFac, Department == "Civil and Environmental Engineering"), filter(CarnegieMellonFac, Department == "Civil and Environmental"), filter(ColoradoBoulderFac, Department == "Civil, Envionmental & Architectural Engineering"), filter(DukeFac, Department == "Civil and Environmental Engineering"), filter(FloridaFac, Department == "Engineering School of Sustainable Infrastructure & Environment"), filter (GeorgiaTechFac, Department == "Civil & Environmental Engineering"), filter(IllinoisUCFac, Department == "Civil and Environmental Engineering"), filter(MichiganFac, Department == "Civil and Environmental Engineering"), filter(MinnesotaFac, Department == "Civil, Environmental, and Geo-Engineering"), filter(UTAustinFac, Department =="Civil, Architectural and Environmental Engineering" | Department == "Petroleum and Geosystems Engineering"), filter(WisconsinFac, Department == "Civil and Environmental Engineering"))

elecFacUS <- rbind(filter(AlbertaFac, Department == "Electrical and Computer Engineering"), filter(CarnegieMellonFac, Department == "Electrical and Computer Engineering"), filter(ColoradoBoulderFac, Department == "Electrical, Computer and Engergy Engineering" | Department == "Computer Science"), filter(DukeFac, Department == "Electrical and Computer Engineering"), filter(FloridaFac, Department == "Electrical and Computer Engineering"), filter (GeorgiaTechFac, Department == "Electrical & Computer Engineering"), filter(IllinoisUCFac, Department == "Electrical and Computer Engineering"), filter(MichiganFac, Department == "Electrical Engineering and Computer Engineering"), filter(MinnesotaFac, Department == "Electrical and Computer Engineering"), filter(UTAustinFac, Department =="Electrical and Computer Engineering"), filter(WisconsinFac, Department == "Electrical & Computer Engineering"))

mechFacUS <- rbind(filter(AlbertaFac, Department == "Mechanical Engineering"), filter(CarnegieMellonFac, Department == "Mechanical Engineering"), filter(ColoradoBoulderFac, Department == "Mechanical Engineering"), filter(DukeFac, Department == "Mechanical Engineering and Materials Science"), filter(FloridaFac, Department == "Mechanical & Aerospace Engineering"), filter (GeorgiaTechFac, Department == "Mechanical Engineering"), filter(IllinoisUCFac, Department == "Mechanical Science and Engineering"), filter(MichiganFac, Department == "Mechanical Engineering"), filter(MinnesotaFac, Department == "Mechanical Engineering"), filter(UTAustinFac, Department =="Mechanical Engineering"), filter(WisconsinFac, Department == "Mechanical Engineering"))

USchemmatFacCt <- gather(chemmatFacUS, key = PY, value = Fac, -Department, -School) %>%
        group_by(School, PY) %>%
        summarise(Fac = sum(Fac))

USCivilFacCt <- gather(civilFacUS, key = PY, value = Fac, -Department, -School) %>%
        group_by(School, PY) %>%
        summarise(Fac = sum(Fac))

USelecFacCt <- gather(elecFacUS, key = PY, value = Fac, -Department, -School) %>%
        group_by(School, PY) %>%
        summarise(Fac = sum(Fac))

USmechFacCt <- gather(mechFacUS, key = PY, value = Fac, -Department, -School) %>%
        group_by(School, PY) %>%
        summarise(Fac = sum(Fac))

USchemmatFac <- spread(USchemmatFacCt, PY, Fac)
UScivilFac <- spread(USchemmatFacCt, PY, Fac)
USelecFac <- spread(USelecFacCt, PY, Fac)
USmechFac <- spread(USmechFacCt, PY, Fac)

##Faculty-level calculation

UScomp <- rbind(chemmatUS, civilUS, elecUS, mechUS) %>%
        count(PY, School) %>%
        spread(PY, n)

USfac <- select(rbind(chemmatFacUS, civilFacUS, elecFacUS, mechFacUS), -Department) %>%
        gather(key = PY, value = Fac, -School, na.rm = TRUE) %>%
        group_by(School, PY) %>%
        summarise(Fac = sum(Fac)) %>%
        spread(PY, Fac)

USapf <- cbind(UScomp[1], round(UScomp[-1]/USfac[-1],1))
        

## Divide number of articles by number of faculty
USchemmatAF <- cbind(USchemmatAY[1], round(USchemmatAY[-1]/USchemmatFac[-1],1))
UScivilAF <- cbind(UScivilAY[1], round(UScivilAY[-1]/UScivilFac[-1], 1))
USelecAF <- cbind(USelecAY[1], round(USelecAY[-1]/USelecFac[-1], 1))
USmechAF <- cbind(USmechAY[1], round(USmechAY[-1]/USmechFac[-1], 1))

UScomp <- rbind(chemmatUS, civilUS, elecUS, mechUS) %>%
        count(PY, School) %>%
        spread(PY, n)

USfac <- select(rbind(chemmatFacUS, civilFacUS, elecFacUS, mechFacUS), -Department) %>%
        gather(key = PY, value = Fac, -School, na.rm = TRUE) %>%
        group_by(School, PY) %>%
        summarise(Fac = sum(Fac)) %>%
        spread(PY, Fac)

USapf <- cbind(UScomp[1], round(UScomp[-1]/USfac[-1],1))
      

kable(arrange(USchemmatAF, desc(USchemmatAF$`2016`)), digits = 2, caption = "Articles per faculty member per year - Chemical Engineering")

kable(arrange(UScivilAF, desc(UScivilAF$`2016`)), digits = 2, caption = "Articles per faculty member per year - Civil Engineering")

kable(arrange(USelecAF, desc(USelecAF$`2016`)), digits = 2, caption = "Articles per faculty member per year - Electrical Engineering")

kable(arrange(USmechAF, desc(USmechAF$`2016`)), digits = 2, caption = "Articles per faculty member per year - Mechanical Engineering")

kable(arrange(USapf, desc(USapf$'2016')), digits = 2, caption = "Articles per faculty member per year - Faculty-level")

```

###Average article impact

```{r include=TRUE, echo=FALSE}
USbiomedTC <- biomedUS %>%
        group_by(School) %>% 
        summarise('Times Cited' = mean(TC))

USchemmatTC <- chemmatUS %>%
        group_by(School) %>% 
        summarise('Times Cited' = mean(TC))
        
UScivTC <- civilUS %>%
        group_by(School) %>% 
        summarise('Times Cited' = mean(TC))

USelecTC <- elecUS %>%
        group_by(School) %>% 
        summarise('Times Cited' = mean(TC))

USmechTC <- mechUS %>%
        group_by(School) %>% 
        summarise('Times Cited' = mean(TC))

USTC <- rbind(biomedUS, chemmatUS, civilUS, elecUS, mechUS) %>%
        distinct(UT, School, .keep_all = TRUE) %>%
        group_by(School) %>%
        summarise('Times Cited' = mean(TC))

kable(arrange(USbiomedTC, desc(USbiomedTC$'Times Cited')), digits = 2, caption = "Mean citations per article - Biomedical Engineering")

kable(arrange(USchemmatTC, desc(USchemmatTC$'Times Cited')), digits = 2, caption = "Mean citations per article - Chemical and Materials Engineering")

kable(arrange(UScivTC, desc(UScivTC$'Times Cited')), digits = 2, caption = "Mean citations per article - Civil Engineering")

kable(arrange(USelecTC, desc(USelecTC$'Times Cited')), digits = 2, caption = "Mean citations per article - Electrical and Computer  Engineering")

kable(arrange(USmechTC, desc(USmechTC$'Times Cited')), digits = 2, caption = "Mean citations per article - Mechanical Engineering")

kable(arrange(USTC, desc(USTC$'Times Cited')), digits = 2, caption = "Mean citations per article per school (matching departments only)")
```

##References

