---
title: "University of Alberta Faculty of Engineering Research Output"
author: "Alison Henry"
date: "13 October 2017"
output: 
        word_document:
                df_print: kable
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE, message = FALSE, warning  = FALSE)
```
A report to examine the publication output of the Univeristy of Alberta Faculty of Engineering. Searches were conducted using Web of Science, and limited to the five publication years from 2012-2016. 
```{r package installation}
## Install and load needed packages

##install.packages("bibliometrix", dependencies = TRUE)
##install.packages("splitstackshape")
##install.packages("tidyverse")
##install.packages("viridis")
##install.packages("knitr")

library(bibliometrix)
library(splitstackshape)
library(tidyverse)
library(viridis)
library(knitr)
```
Initial processing of the data was accomplished with the Bibliometrix package written by Massimo Aria and Corrado Cuccurullo. This allowed easy conversion of records into a data frame to facilitate further processing.

```{r read in bibtex files} 
## Read in downloaded files and convert to dataframe
filePaths = dir("./WoSdata", pattern = "*.bib", recursive = TRUE, full.names = TRUE) 
D <- do.call("readFiles", as.list(filePaths)) 
M <- convert2df(D, dbsource = "isi", format = "bibtex")
```

```{r subset data}
## Keep only selected columns: UT, DT, C1, DT, TC, PY
mydata <- select(M, UT, C1, DT, PY, TC)
```
Data was kept for unique article identifiers, addresses, document type, publication year and number of citations.
```{r separate authors}
## Separate authors into single observations
tidy_data <- cSplit(mydata, "C1", sep = ";", direction = "long")
```

```{r test for drops}
## Test that there were no unintended drops
count <- sum(str_count(mydata$C1, ";"))
ifelse(count + nrow(mydata) == nrow(tidy_data), "No drops", "Warning") 
```

```{r limit to UofA addresses}
## Remove non-UofA addresses
AlbertaData <- tidy_data[grep("UNIV ALBERTA", tidy_data$C1), ]
```
Whole counting is used, so that each publication is counted only once for the institution, but articles with authors from different departments will count toward to totals for each of those departments.
```{r Assign departmental affiliation}

## Identify departmental affiliations: need to automate this
## deptUrl <- ("https://docs.google.com/spreadsheets/d/e/2PACX-1vTMpIJn2N9pV13zRhYKRdOOAUfvHhKF6dqUzMWhnk3_eaBgPD8XT6UJBuAXfyoWfA0qfvaO4LyQpfJA/pub?output=csv")
## depts <- read.csv(deptUrl)

AlbertaData$Dept <- ifelse(grepl(" CHEM ", AlbertaData$C1), "Department of Chemical and Materials Engineering",
                    ifelse(grepl(" MAT ", AlbertaData$C1), "Department of Chemical and Materials Engineering",
                    ifelse(grepl(" CIVIL ", AlbertaData$C1), "Department of Civil and Environmental Engineering",
                    ifelse(grepl(" SCH MIN ", AlbertaData$C1), "Department of Civil and Environmental Engineering",
                    ifelse(grepl(" PETR ", AlbertaData$C1), "Department of Civil and Environmental Engineering",
                    ifelse(grepl(" ELECT ", AlbertaData$C1), "Department of Electrical and Computer Engineering",
                    ifelse(grepl(" MECH ", AlbertaData$C1), "Department of Mechanical Engineering",
                    ifelse(grepl(" BIOMED ", AlbertaData$C1), "Department of Biomedical Engineering",
                    ifelse(grepl(" RESOURCES ", AlbertaData$C1), "Department of Civil and Environmental Engineering",
                    ifelse(grepl(" TRANSPORTATION ", AlbertaData$C1), "Department of Civil and Environmental Engineering",
                           "Other"))))))))))
```

```{r examine "Other"}
## check the "other"s for articles that should be kept
##Other <- filter(AlbertaData, Dept == "Other")
##View(Other)
```
Number of articles per year
```{r include = TRUE, echo = FALSE}
engData <- filter(AlbertaData, Dept != "Other")
deptData <- group_by(engData, Dept) 
fourDepts <- filter(deptData, Dept != "Department of Biomedical Engineering")
```
With BioMed:
```{r}
ppy <- ggplot(unique(deptData), aes(PY)) 
ppy + geom_bar(aes(fill=Dept)) + theme_bw(base_family = "Times") + labs(title = "Articles per Year, by Department", x = "Publication Year", y = "Articles") + scale_fill_viridis("Dept", discrete = TRUE)
```
Without BioMed:
```{r}
ppy4<- ggplot(unique(fourDepts), aes(PY)) 
ppy4 + geom_bar(aes(fill=Dept)) + theme_bw(base_family = "Times") + labs(title = "Articles per Year, by Department", x = "Publication Year", y = "Articles") + scale_fill_viridis("Dept", discrete = TRUE)
```
The initial data load contained three types of documents: Articles, 
Mean number of citations per article
```{r citation summary, results='asis'}
## Report number of citations per department
tab1 <- summarise(deptData, "Times Cited" = mean(TC))
tab1[,sapply(tab1, is.numeric)] <- sapply(tab1[,sapply(tab1, is.numeric)], function(x) sprintf("%1.2f", x))
```
Mean citations per article using only document type "article"
```{r article citation summary, results='asis'}
articleData <- filter(deptData, DT == "ARTICLE ")
tab2 <- summarise(articleData, "Times Cited" = mean(TC))
tab2[,sapply(tab1, is.numeric)] <- sapply(tab1[,sapply(tab1, is.numeric)], function(x) sprintf("%1.2f", x))
```